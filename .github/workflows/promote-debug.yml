name: üöÄ Promote Debug to Production

on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Create Pull Request
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { owner, repo } = context.repo;
            
            // Create PR from preview to main
            try {
              const { data: pr } = await github.rest.pulls.create({
                owner,
                repo,
                title: `Promote debug to production - ${new Date().toISOString().split('T')[0]}`,
                head: 'preview',
                base: 'main',
                body: `## üöÄ Debug ‚Üí Production Promotion
                
                This PR promotes changes from the debug environment to production.
                
                ### ‚úÖ Pre-merge Checklist:
                - [ ] Debug environment tested at \`/debug/\` path
                - [ ] All features working correctly
                - [ ] No console errors
                - [ ] Mobile experience tested
                
                ### üìä Changes:
                Review the commits and files changed below.
                
                ---
                *Auto-generated by promote-debug workflow*`
              });
              
              core.info(`‚úì Pull request created: ${pr.html_url}`);
              core.summary.addHeading('‚úÖ Pull Request Created', 2);
              core.summary.addLink(`PR #${pr.number}`, pr.html_url);
              await core.summary.write();
              
            } catch (error) {
              if (error.message.includes('A pull request already exists')) {
                core.warning('‚ö†Ô∏è  A pull request already exists for preview ‚Üí main');
                core.summary.addHeading('‚ö†Ô∏è  Pull Request Already Exists', 2);
                core.summary.addRaw('A pull request from preview to main already exists. Check existing PRs.');
                await core.summary.write();
              } else {
                core.setFailed(`‚ùå Failed to create PR: ${error.message}`);
                throw error;
              }
            }
